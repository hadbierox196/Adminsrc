<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .tab-btn.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
        }

        button:hover {
            background: #5568d3;
        }

        button.delete-btn {
            background: #ef4444;
            padding: 8px 16px;
            font-size: 14px;
        }

        button.delete-btn:hover {
            background: #dc2626;
        }

        button.edit-btn {
            background: #10b981;
            padding: 8px 16px;
            font-size: 14px;
            margin-right: 8px;
        }

        button.edit-btn:hover {
            background: #059669;
        }

        .list-item {
            background: #f9fafb;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .list-item h3 {
            margin-bottom: 8px;
            color: #667eea;
        }

        .list-item p {
            color: #666;
            margin: 4px 0;
        }

        .actions {
            margin-top: 12px;
        }

        .user-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .success-msg {
            background: #d1fae5;
            color: #065f46;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-msg {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        .img-preview {
            max-width: 200px;
            margin-top: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”§ Admin Dashboard</h1>

        <div class="tabs">
            <button class="tab-btn active" onclick="window.showTab('users', event)">ðŸ‘¥ Manage Users</button>
            <button class="tab-btn" onclick="window.showTab('news', event)">ðŸ“° Manage News</button>
            <button class="tab-btn" onclick="window.showTab('workshops', event)">ðŸŽ“ Manage Workshops</button>
        </div>

        <!-- Users Tab -->
        <div id="users" class="tab-content active">
            <h2>User Management</h2>
            <div class="success-msg" id="user-success"></div>
            <div class="error-msg" id="user-error"></div>
            
            <div class="user-list" id="userList">
                <p style="text-align: center; color: #999;">Loading users...</p>
            </div>

            <!-- Edit User Modal (inline) -->
            <div id="editUserForm" style="display: none; margin-top: 30px; padding: 20px; background: #f0f0f0; border-radius: 8px;">
                <h3>Edit User Details</h3>
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="editUserName">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="editUserEmail">
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <input type="text" id="editUserRole">
                </div>
                <div class="form-group">
                    <label>Batch</label>
                    <input type="text" id="editUserBatch">
                </div>
                <div class="form-group">
                    <label>SMC ID</label>
                    <input type="text" id="editUserSmcId">
                </div>
                <button onclick="updateUser()">Update User</button>
                <button onclick="cancelEditUser()" style="background: #6b7280; margin-left: 10px;">Cancel</button>
            </div>
        </div>

        <!-- News Tab -->
        <div id="news" class="tab-content">
            <h2>News Management</h2>
            <div class="success-msg" id="news-success"></div>
            <div class="error-msg" id="news-error"></div>
            
            <div style="margin-bottom: 30px;">
                <h3>Add New Article</h3>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="newsTitle" placeholder="Enter news title">
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="newsDate">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="newsDescription" placeholder="Enter news description"></textarea>
                </div>
                <div class="form-group">
                    <label>Image URL</label>
                    <input type="url" id="newsImage" placeholder="https://example.com/image.jpg" onchange="previewNewsImage()">
                    <img id="newsImagePreview" class="img-preview" style="display: none;">
                </div>
                <button onclick="addNews()">Add News Article</button>
            </div>

            <hr style="margin: 30px 0;">

            <h3>Existing News</h3>
            <div id="newsList">
                <p style="text-align: center; color: #999;">Loading news...</p>
            </div>
        </div>

        <!-- Workshops Tab -->
        <div id="workshops" class="tab-content">
            <h2>Workshop Management</h2>
            <div class="success-msg" id="workshop-success"></div>
            <div class="error-msg" id="workshop-error"></div>
            
            <div style="margin-bottom: 30px;">
                <h3>Add New Workshop</h3>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="workshopTitle" placeholder="Enter workshop title">
                </div>
                <div class="form-group">
                    <label>Led By</label>
                    <input type="text" id="workshopLedBy" placeholder="Instructor name">
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="workshopDate">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="workshopDescription" placeholder="Enter workshop description"></textarea>
                </div>
                <div class="form-group">
                    <label>Apply Now Link</label>
                    <input type="url" id="workshopLink" placeholder="https://example.com/apply">
                </div>
                <button onclick="addWorkshop()">Add Workshop</button>
            </div>

            <hr style="margin: 30px 0;">

            <h3>Existing Workshops</h3>
            <div id="workshopList">
                <p style="text-align: center; color: #999;">Loading workshops...</p>
            </div>
        </div>
    </div>

    <script>
        // Global functions defined first
        window.showTab = function(tabName, e) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            e.target.classList.add('active');
        };
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getDatabase, ref, set, push, remove, onValue, update } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDF2wmnHZWwLsJ3H20FMdnyNSVE7UNPGUE",
            authDomain: "srcsms-fbe25.firebaseapp.com",
            databaseURL: "https://srcsms-fbe25-default-rtdb.firebaseio.com",
            projectId: "srcsms-fbe25",
            storageBucket: "srcsms-fbe25.firebasestorage.app",
            messagingSenderId: "1085257788571",
            appId: "1:1085257788571:web:19f9d4f327868d1cdfaa3e",
            measurementId: "G-HJD1DPLCXR"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // User Management
        function loadUsers() {
            const usersRef = ref(db, 'users');
            onValue(usersRef, (snapshot) => {
                const userList = document.getElementById('userList');
                userList.innerHTML = '';
                
                if (snapshot.exists()) {
                    const users = snapshot.val();
                    Object.keys(users).forEach(userId => {
                        const user = users[userId];
                        const userDiv = document.createElement('div');
                        userDiv.className = 'list-item';
                        userDiv.innerHTML = `
                            <h3>${user.name || 'N/A'}</h3>
                            <p><strong>Email:</strong> ${user.email || 'N/A'}</p>
                            <p><strong>Role:</strong> ${user.role || 'N/A'}</p>
                            <p><strong>Batch:</strong> ${user.batch || 'N/A'}</p>
                            <p><strong>SMC ID:</strong> ${user.smcId || 'N/A'}</p>
                            <div class="actions">
                                <button class="edit-btn" onclick="editUser('${userId}', ${JSON.stringify(user).replace(/"/g, '&quot;')})">Edit</button>
                                <button class="delete-btn" onclick="deleteUser('${userId}')">Delete</button>
                            </div>
                        `;
                        userList.appendChild(userDiv);
                    });
                } else {
                    userList.innerHTML = '<p style="text-align: center; color: #999;">No users found</p>';
                }
            });
        }

        window.editUser = function(userId, userData) {
            document.getElementById('editUserForm').style.display = 'block';
            document.getElementById('editUserId').value = userId;
            document.getElementById('editUserName').value = userData.name || '';
            document.getElementById('editUserEmail').value = userData.email || '';
            document.getElementById('editUserRole').value = userData.role || '';
            document.getElementById('editUserBatch').value = userData.batch || '';
            document.getElementById('editUserSmcId').value = userData.smcId || '';
            document.getElementById('editUserForm').scrollIntoView({ behavior: 'smooth' });
        };

        window.cancelEditUser = function() {
            document.getElementById('editUserForm').style.display = 'none';
        };

        window.updateUser = function() {
            const userId = document.getElementById('editUserId').value;
            const userData = {
                name: document.getElementById('editUserName').value,
                email: document.getElementById('editUserEmail').value,
                role: document.getElementById('editUserRole').value,
                batch: document.getElementById('editUserBatch').value,
                smcId: document.getElementById('editUserSmcId').value
            };

            update(ref(db, `users/${userId}`), userData)
                .then(() => {
                    showMessage('user-success', 'User updated successfully!');
                    cancelEditUser();
                })
                .catch((error) => {
                    showMessage('user-error', 'Error updating user: ' + error.message);
                });
        };

        window.deleteUser = function(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                remove(ref(db, `users/${userId}`))
                    .then(() => {
                        showMessage('user-success', 'User deleted successfully!');
                    })
                    .catch((error) => {
                        showMessage('user-error', 'Error deleting user: ' + error.message);
                    });
            }
        };

        // News Management
        window.previewNewsImage = function() {
            const url = document.getElementById('newsImage').value;
            const preview = document.getElementById('newsImagePreview');
            if (url) {
                preview.src = url;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        };

        window.addNews = function() {
            const title = document.getElementById('newsTitle').value;
            const date = document.getElementById('newsDate').value;
            const description = document.getElementById('newsDescription').value;
            const image = document.getElementById('newsImage').value;

            if (!title || !date || !description) {
                showMessage('news-error', 'Please fill in all required fields');
                return;
            }

            const newsData = {
                name: title,
                date: date,
                description: description,
                image: image || '/news-collage.png'
            };

            push(ref(db, 'news'), newsData)
                .then(() => {
                    showMessage('news-success', 'News article added successfully!');
                    document.getElementById('newsTitle').value = '';
                    document.getElementById('newsDate').value = '';
                    document.getElementById('newsDescription').value = '';
                    document.getElementById('newsImage').value = '';
                    document.getElementById('newsImagePreview').style.display = 'none';
                })
                .catch((error) => {
                    showMessage('news-error', 'Error adding news: ' + error.message);
                });
        };

        function loadNews() {
            const newsRef = ref(db, 'news');
            onValue(newsRef, (snapshot) => {
                const newsList = document.getElementById('newsList');
                newsList.innerHTML = '';
                
                if (snapshot.exists()) {
                    const news = snapshot.val();
                    Object.keys(news).forEach(newsId => {
                        const item = news[newsId];
                        const newsDiv = document.createElement('div');
                        newsDiv.className = 'list-item';
                        newsDiv.innerHTML = `
                            <h3>${item.name}</h3>
                            <p><strong>Date:</strong> ${item.date}</p>
                            <p>${item.description}</p>
                            ${item.image ? `<img src="${item.image}" style="max-width: 200px; margin-top: 10px; border-radius: 8px;">` : ''}
                            <div class="actions">
                                <button class="delete-btn" onclick="deleteNews('${newsId}')">Delete</button>
                            </div>
                        `;
                        newsList.appendChild(newsDiv);
                    });
                } else {
                    newsList.innerHTML = '<p style="text-align: center; color: #999;">No news articles found</p>';
                }
            });
        }

        window.deleteNews = function(newsId) {
            if (confirm('Are you sure you want to delete this news article?')) {
                remove(ref(db, `news/${newsId}`))
                    .then(() => {
                        showMessage('news-success', 'News article deleted successfully!');
                    })
                    .catch((error) => {
                        showMessage('news-error', 'Error deleting news: ' + error.message);
                    });
            }
        };

        // Workshop Management
        window.addWorkshop = function() {
            const title = document.getElementById('workshopTitle').value;
            const ledBy = document.getElementById('workshopLedBy').value;
            const date = document.getElementById('workshopDate').value;
            const description = document.getElementById('workshopDescription').value;
            const link = document.getElementById('workshopLink').value;

            if (!title || !ledBy || !date || !description) {
                showMessage('workshop-error', 'Please fill in all required fields');
                return;
            }

            const workshopData = {
                name: title,
                ledBy: ledBy,
                date: date,
                description: description,
                applyLink: link || '#'
            };

            push(ref(db, 'workshops'), workshopData)
                .then(() => {
                    showMessage('workshop-success', 'Workshop added successfully!');
    document.getElementById('workshopTitle').value = '';
                    document.getElementById('workshopLedBy').value = '';
                    document.getElementById('workshopDate').value = '';
                    document.getElementById('workshopDescription').value = '';
                    document.getElementById('workshopLink').value = '';
                })
                .catch((error) => {
                    showMessage('workshop-error', 'Error adding workshop: ' + error.message);
                });
        };

        function loadWorkshops() {
            const workshopsRef = ref(db, 'workshops');
            onValue(workshopsRef, (snapshot) => {
                const workshopList = document.getElementById('workshopList');
                workshopList.innerHTML = '';
                
                if (snapshot.exists()) {
                    const workshops = snapshot.val();
                    Object.keys(workshops).forEach(workshopId => {
                        const workshop = workshops[workshopId];
                        const workshopDiv = document.createElement('div');
                        workshopDiv.className = 'list-item';
                        workshopDiv.innerHTML = `
                            <h3>${workshop.name}</h3>
                            <p><strong>Led by:</strong> ${workshop.ledBy}</p>
                            <p><strong>Date:</strong> ${workshop.date || 'N/A'}</p>
                            <p>${workshop.description}</p>
                            ${workshop.applyLink ? `<p><strong>Apply Link:</strong> <a href="${workshop.applyLink}" target="_blank">${workshop.applyLink}</a></p>` : ''}
                            <div class="actions">
                                <button class="delete-btn" onclick="deleteWorkshop('${workshopId}')">Delete</button>
                            </div>
                        `;
                        workshopList.appendChild(workshopDiv);
                    });
                } else {
                    workshopList.innerHTML = '<p style="text-align: center; color: #999;">No workshops found</p>';
                }
            });
        }

        window.deleteWorkshop = function(workshopId) {
            if (confirm('Are you sure you want to delete this workshop?')) {
                remove(ref(db, `workshops/${workshopId}`))
                    .then(() => {
                        showMessage('workshop-success', 'Workshop deleted successfully!');
                    })
                    .catch((error) => {
                        showMessage('workshop-error', 'Error deleting workshop: ' + error.message);
                    });
            }
        };

        // Utility function to show messages
        function showMessage(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        // Initialize
        loadUsers();
        loadNews();
        loadWorkshops();
    </script>
</body>
</html>
